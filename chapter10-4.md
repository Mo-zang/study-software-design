### 경쟁 조건을 방지하기 위해 로직을 원자적으로 만들기
* 현재 예시
  * DB에서 request-id를 검색
  * request-id 를 찾지 못하면 메일서비스 로직을 수행
  * DB에 request-id를 저장
* 2번째 단계가 일관성을 깨뜨릴 수 있음에 주목.
* 1, 3단계가 실패할 수 있는 가능성을 염두에 두어야함.
  * 3단계에서 request-id를 저장하는 로직이 수행중일때 N + 1번째의 1단계 작업이 실행될 수 있음.
    * 고로 두가지 단계를 통합해버리는것이 해법이 될 수 있다.
      * 초당 N개의 (많은 데이터)를 처리해야하는 경우 해법이 되지 않을 수 있음. 적절한 상황을 고려해야함.
        * Eloquent ORM의 UpdateOrInsert 같은거 사용하는 경우?



#### 결론 
* 모든 처리 서비스가 멱등성을 보장할 수 없다.
* 하지만 멱등성을 고려하여 시스템을 설계하면 내결함성이 강해진다
  * 안정적이지 않은 연산을 재시도 하지 않도록 시스템을 보호하는 메커니즘을 설계할 필요가 있다.
* 복잡한 중복제거 로직이 없다면 재시도가 불가능 하기에 모든 요청의 실패가 어플리케이션 관점에서 중요해진다.
  * 중복제거 로직이 없는경우, 시스템의 내결함성과 안정성 관점에서 이상적이지 않음.
* 일관성이 기대되지만 다른식으로 동작하는 시스템은 위험하다.
  * 여러문제가 발생하기 때문.